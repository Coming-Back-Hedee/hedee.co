{% extends 'base.html.twig' %}

{% block title %}Mon compte{% endblock %}
 {% block stylesheets %}
    <link rel="stylesheet" href="{{asset('css/style_espace_client.css')}}">
    <link rel="stylesheet" type="text/css" href="{{asset('css/iconselect.css')}}" >
    <script type="text/javascript" src="{{asset('js/iconselect.js')}}"></script>
        
    <script type="text/javascript" src="{{asset('js/iscroll.js')}}"></script>
{% endblock %}
{% block main %}
    <div class="bloc_header">
        <h3>Mon compte</h3>
        <h1 id="header_title"></h1>
    </div>
    <div class="container">
        <div id="wrapper">
            <div class="row">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-3">

                    <!-- Sidebar -->
                    <div id="sidebar-wrapper">
                        <nav id="spy">
                            <ul class="sidebar-nav nav">
                                <li class="profile">
                                    <img class="photo-profil" src="{{asset('img/emoji/=D.png')}}" alt="Photo de votre profil" />
                                    <div class="hello_profil">
                                        <p class="profil-label">Bonjour </p>
                                        <p class="profil-name"> {{app.user.prenom}} !</p>
                                    </div>
                                </li>
                                <li class="middle">
                                    <a href="#anch1">
                                        <span class="fa fa-chevron-right"> Mes demandes de remboursement</span>
                                    </a>
                                </li>
                                <li class="middle">
                                    <a href="#anch1">
                                        <span class="fa fa-chevron-right"> Mes informations personnelles</span>
                                    </a>
                                </li>
                                <li class="middle">
                                    <a href="#anch1" >
                                        <span class="fa fa-chevron-right"> Mon porte-monnaie</span>
                                    </a>
                                </li>
                                <li class="middle">
                                    <button class="demande_button">
                                        <a  href="{{path('enseigne')}}" title="Je fais une nouvelle demande">
                                            Je fais une nouvelle demande
                                        </a>
                                    </button>
                                    <button class="compte_button">
                                        <a href="{{path('logout')}}" title="Je me déconnecte">
                                            Je me déconnecte
                                        </a>
                                    </button>
                                </li>
                            </ul>
                            
                        </nav>
                    </div>
                </div>

                <!-- Page content -->
                <div class="col-lg-1"><button id="coming_back">Retour</button></div>
                <div class="col-xs-11 col-sm-11 col-md-11 col-lg-8">
                    <div id="page-content-wrapper">
                        <div class="row">
                            <div class="col-md-12 well">
                                <legend id="anch1"></legend>

                            </div>
                        </div>

                            {#<div class="navbar navbar-default navbar-static-bottom">
                                <p class="navbar-text pull-left">
                                    Built by <a href="http://mvnguyen.com" target="_blank">Michael V Nguyen
                                </p>
                            </div>#}
                    </div>
                </div>
            </div>

        </div>
    </div>
    <div class="bloc_footer"></div>
      
{% endblock %}
{% block javascript %}

<script>        
    $(document).ready(function() {
        window.onpopstate = function(e){
            e.preventDefault()
            alert()
        }
        $('#coming_back').click(function(){
            $('#sidebar-wrapper').show()
            $('#page-content-wrapper').hide()
            $('.active').removeClass('active')

        });
        var section = document.querySelectorAll("a[href='#anch1']")
        Array.from(section).forEach(function(li){
            li.addEventListener('click', function(e){
                e.preventDefault()
                switch(li.firstElementChild.innerText){
                    case 'Mon porte-monnaie':
                        if(!$(this).parent().hasClass('active')){
                            url = "{{ path('gains') }}";
                            $('.active').removeClass('active')
                            $(this).parent().addClass('active')
                            changeTab(url)
                            if(window.innerWidth < 1025){
                                $('#sidebar-wrapper').hide()
                                $('#page-content-wrapper').show()

                            }
                        }
                        break;
                        
                    case 'Mes demandes de remboursement':
                        if(!$(this).parent().hasClass('active')){
                            url = "{{ path('demandes') }}";
                            $('.active').removeClass('active')
                            $(this).parent().addClass('active')
                            changeTab(url)
                            if(window.innerWidth < 1025){
                                $('#sidebar-wrapper').hide()
                                $('#page-content-wrapper').show()

                            }
                        }
                        break;

                    case 'Mes informations personnelles':
                        if(!$(this).parent().hasClass('active')){
                            url = "{{ path('info_client') }}";
                            $('.active').removeClass('active')
                            $(this).parent().addClass('active')
                            changeTab(url)
                            if(window.innerWidth < 1025){
                                $('#sidebar-wrapper').hide()
                                $('#page-content-wrapper').show()
                            }
                        }
                        break;
                }                
            })

        });

        function changeTab(url){
            $.ajax({
                type: 'get',
                url: url,
                success: function (data) {
                    $("#anch1").html(data);
                    var title;
                    switch(url){
                        case "{{path('info_client')}}":
                            var iconSelect;
                            var selectedText;
                                        
                            selectedText = document.getElementById('selected-text');
                                        
                            document.getElementById('my-icon-select').addEventListener('changed', function(e){
                                selectedText.value = iconSelect.getSelectedValue();
                            });
                                        
                            iconSelect = new IconSelect("my-icon-select");

                            var icons = [];
                            icons.push({'iconFilePath':'{{asset("img/emoji/;).png")}}', 'iconValue':'1'});
                            icons.push({'iconFilePath':'{{asset("img/emoji/=D.png")}}', 'iconValue':'2'});
                            icons.push({'iconFilePath':'{{asset("img/emoji/=o.png")}}', 'iconValue':'3'});
                                        
                            iconSelect.refresh(icons);
                            title = "Mes informations personnelles";
                            break;
                        case "{{path('demandes')}}":
                            title = "Mes demandes de remboursement";
                            break;
                        
                        case "{{path('gains')}}":
                            title = "Mon porte-monnaie";
                            break;
                    }
                    $("#header_title").html(title)      
                }
            });
        }
          
        if(window.innerWidth >= 1025){
            window.onload = changeTab("{{ path('demandes') }}");
            $('.middle:first').addClass('active')
        }
        else{
            window.onbeforeunload =  function(e){
                if(($('.active').length > 0)){
                    //e.preventDefault();
                    location.href = document.referrer;
                    $('#sidebar-wrapper').show()
                    $('#page-content-wrapper').hide()
                    $('.active').removeClass('active')
                    return false;
                }
                
                //console.log(e)
                
            }
        }

    });
</script>

{% endblock %}